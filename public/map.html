<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Lantmäteriets Fjällkarta</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <!-- PLEASE GET YOUR OWN API KEY, and do not use this one -->
    <script type="text/javascript"
        src="https://maps.google.com/maps/api/js?key=AIzaSyALmVkciVN-o90PkQ_AlJiBUo6-S_MNEs4"></script>
    <script src="./js/GPXParser.min.js"></script>

    <script type="text/javascript">

        function init() {
            var mapMinZoom = 5;
            var mapMaxZoom = 12;

            var map = new google.maps.Map(document.getElementById("map"), {
                streetViewControl: false,
                center: new google.maps.LatLng(65.0469730033129, 16.8471242003942),
                zoom: 6
            });

            map.overlayMapTypes.insertAt(0, new google.maps.ImageMapType({
                getTileUrl: function (coord, zoom) {
                    zoom--;
                    if (mapMinZoom <= zoom && zoom <= mapMaxZoom)
                        return "./tiles/" + zoom + "/" + coord.x + "/" + coord.y + ".jpg?raw=true";
                    else
                        return "none.png";
                },
                tileSize: new google.maps.Size(512, 512),
            }));

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {
                    // Typical action to be performed when the document is ready:
                    var gpx = new gpxParser(); //Create gpxParser Object
                    gpx.parse(xhttp.responseText); //parse gpx file from string data

                    // console.log(xhttp.responseText);
                    document.getElementById("demo").innerText = Math.floor(gpx.tracks[0].distance.total / 1000) + "km";
                    console.log(gpx)
                    let points=gpx.tracks[0].points;
                    const flightPlanCoordinates = [];
                    for (let i in points) {
                        let point=points[i];
                        flightPlanCoordinates.push({  lat: point.lat, lng: point.lon });
                    }
                    const flightPath = new google.maps.Polyline({
                        path: flightPlanCoordinates,
                        geodesic: true,
                        strokeColor: "#FF0000",
                        strokeOpacity: 1.0,
                        strokeWeight: 2,
                    });

                    flightPath.setMap(map)
                    // document.getElementById("demo").innerText =  gpx.tracks;

                }
            };

            // xhttp.open("GET", "/Track.gpx", true);
            xhttp.open("GET", "/tobias-utsidan-track.gpx", true);
            xhttp.send();

        }
    </script>
    <style>
        html,
        body,
        #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body onload="init();
console.log('started')">
    <H4>Code and map from <a
            href="https://github.com/johanberonius/Lantmateriets-Fjallkarta">https://github.com/johanberonius/Lantmateriets-Fjallkarta</a>
    </H4>
    <div id="demo"></div>
    <div id="map"></div>
</body>

</html>